import React from 'react'
import Card from '../ui/Card.jsx'
export default function Offices({ data, query }){ if(!data) return <div>Loading...</div>; const [counties,setCounties]=React.useState(new Set()); const [names,setNames]=React.useState(new Set()); const [showFilters,setShowFilters]=React.useState(false); const q=(query||'').toLowerCase(); const toggle=(set,value)=>{const next=new Set(set); next.has(value)?next.delete(value):next.add(value); return next}; const all=data.offices.locations||[]; const serviceList=Array.from(new Set(all.map(o=>o.service).filter(Boolean))).sort(); const nameList=Array.from(new Set(all.map(o=>o.name))).sort(); let items=all; if(counties.size>0) items=items.filter(o=>counties.has(o.service)); if(names.size>0) items=items.filter(o=>names.has(o.name)); if(q) items=items.filter(o=>[o.name,o.address,o.service,(o.providers||[]).join(' ')].join(' ').toLowerCase().includes(q)); const Pill=({label,active,onClick})=> <button onClick={onClick} className={`pill ${active?'on':'off'}`}>{label}</button>; return (<div className='space-y-4'><div className='sm:hidden'><button onClick={()=>setShowFilters(s=>!s)} className='border rounded-xl px-3 py-2 w-full text-left'>Filters {showFilters?'▲':'▼'}</button>{showFilters&&<div className='mt-2 space-y-2 border rounded-xl p-3'><div className='text-sm font-semibold'>Service Type</div><div className='flex flex-wrap gap-2'>{serviceList.map(c=><Pill key={c} label={c} active={counties.has(c)} onClick={()=>setCounties(toggle(counties,c))}/>)}</div><div className='text-sm font-semibold mt-2'>Location</div><div className='flex flex-wrap gap-2'>{nameList.map(n=><Pill key={n} label={n} active={names.has(n)} onClick={()=>setNames(toggle(names,n))}/>)}</div></div>}</div><div className='hidden sm:block sticky-top bg-white border rounded-xl p-3 space-y-2'><div className='text-sm font-semibold'>Filter by Service Type</div><div className='flex flex-wrap gap-2'>{serviceList.map(c=><Pill key={c} label={c} active={counties.has(c)} onClick={()=>setCounties(toggle(counties,c))}/>)}</div><div className='text-sm font-semibold mt-2'>Filter by Location</div><div className='flex flex-wrap gap-2'>{nameList.map(n=><Pill key={n} label={n} active={names.has(n)} onClick={()=>setNames(toggle(names,n))}/>)}</div></div><div className='grid md:grid-cols-2 gap-4'>{items.map((o,i)=>(<Card key={i} title={o.name}><div className='space-y-2'>{o.address&&<div><b>Address:</b> {o.address}</div>}{o.service&&<div><b>Service Type:</b> {o.service}</div>}{o.url&&<div><a className='underline' href={o.url} target='_blank' rel='noreferrer'>Location page</a></div>}</div></Card>))}</div></div>) }